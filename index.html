function doPost(e) {
  const text = e.parameter.text;
  if (!text) {
    return ContentService
      .createTextOutput("Missing text")
      .setMimeType(ContentService.MimeType.TEXT);
  }

  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheets()[0];
  const id = Utilities.getUuid().substring(0, 8);
  const baseUrl = "https://maharjanil.github.io/textreader/";
  const link = baseUrl + "#" + id;
  const timestamp = new Date();

  // Save: id, text, link, timestamp
  sheet.appendRow([id, text, link, timestamp]);

  return ContentService
    .createTextOutput(link)
    .setMimeType(ContentService.MimeType.TEXT);
}

function doGet(e) {
  const id = e.parameter.id;
  if (!id) {
    return ContentService
      .createTextOutput("ID required")
      .setMimeType(ContentService.MimeType.TEXT);
  }

  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheets()[0];
  const data = sheet.getDataRange().getValues();

  for (let i = 1; i < data.length; i++) {
    if (data[i][0] === id) {
      return Content4Service
        .createTextOutput(data[i][1])
        .setMimeType(ContentService.MimeType.TEXT);
    }
  }
  return ContentService
    .createTextOutput("Not found")
    .setMimeType(ContentService.MimeType.TEXT);
}
